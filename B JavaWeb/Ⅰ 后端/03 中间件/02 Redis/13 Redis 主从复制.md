## 1 前景

Redis是单机、单节点、单实例的，会遇到如下问题：

- 单点故障
- 容量有限
- 压力

AKF扩展立方体

![image-20200719003124588](https://yeyangshu-picgo.oss-cn-shanghai.aliyuncs.com/img/image-20200719003124588.png)

- x轴：全量、镜像
- y轴：业务、功能
- z轴：优先级、逻辑

通过AKF使一台机器变为多台，如何保持数据一致性？

解决方案：

1. 强一致性

   所有节点阻塞直到数据全部一致，所有同步的方式都为阻塞方式

   图

   存在问题：强一致性会破坏可用性，违背最初实现可用性的初衷

2. 强一致性降级，允许数据丢失一部分

   所有同步方式都是异步方式

   图

   存在问题：数据丢失

3. 最终数据一致性

   同步阻塞，将消息传递给可靠、集群、响应速度足够快的中间件（比如kafka）

   图

   存在问题：数据不一致



主备

主从

Redis倾向于主从，问题，主读写，又是一个单点的

对主做高可用（HA，High Availability），期望主发生单点故障时自动做故障转移