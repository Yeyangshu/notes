# Redis管道（Pipelining）

官网链接：http://redis.cn/topics/pipelining.html

Redis是一种基于客户端-服务端模型以及请求/响应协议的TCP服务。

通常情况下，一个请求会遵循以下步骤：

- 客户端向服务器发送一个查询请求，并监听socket返回，通常是以阻塞形式，等待服务端响应。
- 服务端处理命令，并将结果返回给客户端。

客户端和服务器通过网络进行连接，这个连接可以很快，也可能很慢（建立了一个多次跳转的网络连接）。无论网络如何延时，数据包总是能从客户端到达服务器，并从服务器返回数据给客户端。

这个时间被称之为RTT（Round Trip Time，往返时间）。当客户端需要在一个批处理中执行多次请求时很容易看到这时如何影响性能的，每发一次请求都要执行一次数据的传输。

那么如何一次发送多个命令，节省往返时间呢？



管道（Pipelining）：学习如何一次发送多个命令，节省往返时间。

## 1 nc

nc，netcat的缩写

### 1.1 nc的作用

1. 实现任意TCP/UDP端口的侦听，nc可以作为server以TCP或UDP方式侦听指定端口
2. 端口的扫描，nc可以作为client发起TCP或UDP连接
3. 机器之间传输文件
4. 机器之间网络测速 

### 1.2 nc安装

```shell
# 安装nc
yum install nc
# 连接到localhost:6379端口，建立socket通信
nc localhost 6379
```

## 2 管道

管道：一次请求/响应服务器能实现处理新的请求即使旧的请求还未被响应。这样就可以将多个命令发送到服务器，而不用等待回复，最后在一个步骤中读取该答复。

### 2.1 管道的使用

 ```shell
# 使用nc建立socket连接，使用echo发送三个命令
[root@node1 init.d]# echo -e "set k2 99\n incr k2\n get k2" | nc localhost 6379
# 代表set k2成功
+OK
# 代表返回100，100的宽度是3
:100
$3
# 代表get k2的值
100
 ```

## 3 扩展知识：Redis冷启动

系统第一次启动的时候，Redis的缓存中没有数据，如果这时有大量的数据访问，Redis就会去请求数据库，造成数据库的崩溃。

解决办法就是在冷启动之前，可以将数据库的热点数据写入Redis缓存中，或者将数据写成文件，将数据写进内存中去，这个时候就涉及到大量插入数据，就会用到管道的功能。