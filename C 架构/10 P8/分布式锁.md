# 分布式锁实现

1. 什么是锁？

2. 解决什么问题？

3. 单机版怎么玩？

   - synchronized wait notify

   - ReentrantLock

4. 分布式锁怎么玩？

   **单机版锁+TCP/IP=多机版锁**

## 1 什么是分布式锁？

当多个进程在同一系统中，用分布式锁控制多个进程对资源的访问

分布式锁应用场景

1. 传统的单体应用单机部署情况下，可以使用Java并发处理相关的API进行互斥控制。
2. 分布式系统由于多线程，多进程分布在不同的机器上，使单机部署情况下的并发控制锁策略失效，为了解决跨JVM互斥机制来控制共享资源的访问，这就是分布式锁的来源；分布式锁应用场景大都是高并发、大流量场景。

## 2 基于MySQL分布式锁实现

## 3 基于Redis分布式锁实现

### 3.1 Redis分布式锁实现原理

基于Redisson对Redis分布式锁的实现；

1. 加锁机制：根据hash节点选择一个客户端执行lua脚本
2. 锁互斥机制：再来一个客户端执行同样的lua脚本会提示已经存在锁，然后进入循环一直尝试加锁
3. 可重入机制
4. watch log自动延迟机制
5. 释放锁机制

架构图36:19

### 3.2 Redis分布式锁测试用例

#### Redis单机分布式锁

38:12

#### Redis红锁

### 3.3 Redis分布式锁源码分析

38:48



## 3 基于Zookeeper分布式锁实现

## 4 基于Etcd分布式锁实现
