# 架构设计面试题

## 秒杀

### 如何做一个秒杀系统

#### 秒杀系统的关键点

主要解决2个问题，一个是并发读，一个是并发写。整体概况为“稳、准、快”

- 高性能
- 高可用
- 一致性

2、如何实现高可用、高并发、高吞吐的技术方案

3、A给B发请求，B执行往数据库insert的操作；设计一个架构，保证能够提供最大的并发量

强一致性和弱一致性有什么方法来实现的？

## 开放性问题

### 一个大文件4G,里面一行行的数字,这时内存只有256M,如果做排序?

（1）在外部排序选出结果， 然后往内存读写
（2）数据分组进入内存， 然后用trie统计个数（trie树有10M的内存应该是够的）

### 如果你部署的应用所在机器硬盘坏了,会发生什么?你的程序要如何处理这种异常?

分布式系统中故障是一种常态，设计要避免单点故障，能容错，保证系统高可用

### 实现一个消息队列系统

https://tech.meituan.com/2016/07/01/mq-design.html

https://juejin.cn/post/6844903806904303623

消息队列的参与者：消息生产Producer、消息服务端Broker、消息消费者Consumer

#### 设计重点

- 消息的转储
- 规范一种范式和通用的模式，以满足解耦、最终一致性、错峰等需求。
- 其实简单理解就是一个消息转发器，把一次RPC做成两次RPC，发送者把消息投递到broker，broker再将消息转发一手到接收端。

#### 基础功能

- 消息的传输

- 存储

- 消费

涉及到如下三个方面的设计：

1. 通信协议

   JMS

   - 点对点
   - publish-subscribe（发布订阅）模型

2. 存储选择

   对于分布式系统，存储的选择有以下几种

   1. 内存

   2. 本地文件系统

   3. 分布式文件系统

   4. nosql

   5. DB

3. 消费关系维护

   单播与广播的区别。

   - 单播，就是点到点；
   - 广播，是一点对多点

#### 高级特性

- 消息的顺序
- 投递可靠性保证
- 消息持久化
- 支持不同消息模型
- 多实例集群功能
- 事务特性等

### 如何设计一个高可用的架构

### 多次Hash来解决URL重复访问问题

对每一个给定的URL，都是用一个已经建立好的Hash函数，映射到某个物理地址上。当需要进行检测URL是否重复的时候，只需要将这个URL进行Hash映射，如果得到的地址已经存在，说明已经被下载过，放弃下载，否则，将该URL及其Hash地址作为键值对存放到Hash表中。 
这样，URL去重存储库就是要维护一个Hash表，如果Hash函数设计的不好，在进行映射的时候，发生碰撞的几率很大，则再进行碰撞的处理也非常复杂。而且，这里使用的是URL作为键，URL字符串也占用了很大的存储空间。
为了尽快把整个爬虫搭建起来，最开始的URL去重采用方案是一个内存中的HashSet，这是最直观的方法，所有人都能想得到。HashSet中放置的就是URL的字符串，任何一个新的URL首先在HashSet中进行查找，如果HashSet中没有，就将新的URL插入HashSet，并将URL放入待抓取队列。

### 全局唯一ID问题

### 秒杀如何设计

### 如何进行性能优化

### 发现CPU 100%，如何排查?

### 实现一个分布式打点系统

### SSO互相登录的问题

- SSO

- 跨域问题

### 如何快速对一个2亿数据的List进行排序