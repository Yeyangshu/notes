## Redis面试题

## 1 Redis原理

### Redis使用单线程的好处

1. 代码更清晰，处理逻辑更简单
2. 不用去考虑各种锁的问题，不存在加锁释放锁操作，没有因为可能出现死锁而导致的性能消耗
3. 不存在多进程或者多线程导致的切换而消耗CPU



### Redis中如何控制多线程并发

select+poll模型（轮询）

epoll模型

1. 调用epoll_create建立一个epoll对象(在epoll文件系统中给这个句柄分配资源，在内核cache里建了个红黑树用于存储以后epoll_ctl传来的socket外，还会再建立一个rdllist双向链表，用于存储准备就绪的事件，

2. 调用epoll_ctl向epoll对象中（红黑树中）添加这100万个连接的套接字；

3. 调用epoll_wait收集发生事件的连接。当epoll_wait调用时，仅仅观察这个rdllist双向链表里有没有数据即可。有数据就返回

![image-20210104220848714](https://yeyangshu-picgo.oss-cn-shanghai.aliyuncs.com/img/image-20210104220848714.png)****

## 2 基本数据类型

### 2.1 Redis数据类型及应用场景（必考）

1. String
   - String类型：set nx 分布式锁
   - 数值INCR、DECR：抢购、秒杀、详情页、点赞、评论，对书数据库的操作完全有内存代替。
   - bitmap：
     - 登陆天数，名做key，位0和1做登录数据
     - 活动礼物：分辨冷热用户，日期做key，位做用户是否登录，bittop or去重，bitcount统计
2. List：可以实现栈、队列、数组、单播队列，聊天系统
3. Hash：详情页、的点赞、收藏
4. Set：无序，随机事件SRANDMEMBER，用于抽奖
5. Sorted_set(ZSet)：有序，可以做排行榜

### 2.2 sortedSet的底层数据结构（必考）

排行榜功能的实现：使用Redis的zset；zset的底层数据结构是什么样的；除了Redis的zset还有什么其他的数据结构可以实现这个功能

跳表

## 3 缓存击穿，缓存穿透，缓存雪崩

### 3.1 解释一下缓存击穿，缓存穿透，缓存雪崩，如何解决这些问题

正常情况下，查询的数据都存在，如果请求一个不存在的数据，也就是缓存和数据库都查不到这个数据，每次都会去数据库查询，这种查询不存在数据的现象我们称为缓存穿透。

### 3.2 布隆过滤器

## 4 缓存LRU

### Redis的数据过期策略（必考）

业务逻辑：key的有效期

业务运转：内存有限



### Redis key的时间有效期会随着访问延长吗？

假设key的有效期设置为10s，9s的时候别人读了它，重新计时时长，证明他是热数据？

答：不对

1. key的有效期不会延长

   ```shell
   # 先给k1设置20s有效期
   127.0.0.1:6379> set k1 aa ex 20
   OK
   127.0.0.1:6379> ttl k1
   (integer) 14
   127.0.0.1:6379> ttl k1
   (integer) 2
   127.0.0.1:6379> ttl k1
   (integer) 0
   # k1时间过期
   127.0.0.1:6379> ttl k1
   (integer) -2
   # 有效期时间之后key不存在
   127.0.0.1:6379> get k1 
   (nil)
   ```

2. 在有效期内发生写会剔除有效期时间，EXPIRE

   ```shell
   # 设置k1
   127.0.0.1:6379> set k1 aa
   OK
   # 此时k1有效期是永久值
   127.0.0.1:6379> ttl k1
   (integer) -1
   # 人为为k1设置时间，30s
   127.0.0.1:6379> EXPIRE k1 30
   (integer) 1
   # 倒计时
   127.0.0.1:6379> ttl k1
   (integer) 28
   # 存活时间内写新值
   127.0.0.1:6379> set k1 bbb
   OK
   # k1有效期时间被剔除，重新为永久值
   127.0.0.1:6379> ttl k1
   (integer) -1
   # 查询是新值
   127.0.0.1:6379> get k1 
   "bbb"
   ```

### 主动过期、被动过期

为什么这个设置主动和被动两种方式？

牺牲一下内存，保证Redis的性能

## 5 数据库持久化

### 5.1 Redis的持久化机制（必考）

## 6 主从复制

## 7 集群

### 集群环境下如何处理，解释一下一致性哈希

### 如何保证数据一致性问题

### Redis集群种类：主从模式、cluster模式及其应用

## 8 分布式锁

### 利用Redis实现分布式锁